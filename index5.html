<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>05. 코드를 값으로 다루어 표현력 높이기</title>
</head>
<body>
  <script src="./js/fx.js"></script>

  <script>
    const products = [
      {name: '반팔티', price: 15000},
      {name: '긴팔티', price: 20000},
      {name: '핸드폰케이스', price: 15000},
      {name: '후드티', price: 30000},
      {name: '바지', price: 25000}
    ];

    const add = (a, b) => a + b;

    console.log(
      reduce(
        add,
        map(p => p.price,
          filter(p => p.price < 20000, products))));
    console.clear();
  </script>
  
  # 코드를 값으로 다루어 표현력 높이기
  
  ## go: 함수들과 인자를 전달해서 즉시 값을 평가하는데 사용, 
  pipe: 함수를 리턴하는 함수, 함수들이 나열되어 있는 합성된 함수를 만들어줌
  
  <script>
    // const go = (...args) => reduce((a, f) => f(a), args); // 첫번째 결과를 다음의 인자로 넘겨야...
    go(
      0,
      a => a +1,
      a => a +10,
      a => a +100,
      console.log
    )
    // const pipe = (f, ...fs) => (...as) => go(f(...as), ...fs);
    // const pipe = (...fs) => (a) => go(a, ...fs);
    // 세개의 함수를 연속적으로 실행하면서 축약하는 함수를 만들고 그 함수를 리턴 
    // 내부적으로 go를 사용함
    // 첫번째 함수는 인자를 두개도 받을 수 있도록 설정하는 게 좋음
    const f = pipe(
      (a, b) => a + b,
      a => a + 10,
      a => a + 100
    );

    console.log(f(0, 1));
  </script>
  
  <script>
    // go(
    //   products,
    //   products => filter(p => p.price < 20000, products),
    //   products => map(p => p.price, products),
    //   prices => reduce(add, prices),
    //   console.log
    // )

    // curry적용한 후 
    // go(
    //   products,
    //   products => filter(p => p.price < 20000)(products),
    //   products => map(p => p.price)(products),
    //   prices => reduce(add)(prices),
    //   console.log
    // )

    go(
      products,
      filter(p => p.price < 20000),
      map(p => p.price),
      reduce(add),
      console.log
    )
  </script>
  
  ## curry
  함수를 받아서 함수를 리턴, 인자를 받아서 원하는 갯수만큼의 인자가 들어왔을 때 받아두었던 함수를 나중에 평가시키는 함수 
  <script>
    // const curry = f => (a, ..._) =>_.length ? f(a, ..._) : (..._) => f(a, ..._);
    // 함수를 받아서 함수를 리턴,
    // 리턴된 함수가 실행됐을 때 인자가 2개 이상이면 받아둔 함수를 즉시 실행
    // 만약 인자가 두개 아래라면 함수를 다시 리턴한 후에 그 이ㅜ에 받은 인자들을 합쳐서 실행             

    const mult = curry((a, b) => a * b);
    console.log(mult(1)(2));

    const mult3 = mult(3);
    console.log(mult3(10));
    console.log(mult3(5));
    console.log(mult3(3));
  </script>
  
  # 함수 조합으로 함수 만들기
  
  <script>
    const total_price = pipe(
      map(p => p.price),
      reduce(add)
    );
    const base_total_price = predi => pipe(
      filter(predi),
      total_price
    )

    go(
      products,
      base_total_price(p => p.price < 20000),
      // filter(p => p.price < 20000),
      // total_price,
      console.log
    )
    go(
      products,
      base_total_price(p => p.price >= 20000),
      // filter(p => p.price >= 20000),
      // total_price,
      console.log
    )
  </script>
  </body>
</html>